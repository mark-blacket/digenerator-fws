#include "digenerator.h"

#define BUFSIZE 64

const uint8_t table[16][BUFSIZE] = {
    {193, 254, 229, 219, 230, 220, 212, 217, 210, 202, 205, 200, 192, 193, 190, 182, 182, 180, 172, 171, 169, 162, 160, 159, 152, 149, 148, 142, 138, 137, 132, 127,
     127, 122, 117, 116, 112, 106, 105, 102,  95,  94,  92,  85,  83,  82,  74,  72,  72,  64,  61,  62,  54,  49,  52,  44,  37,  42,  34,  24,  35,  25,   0,  61},
    {160, 184, 157, 140, 143, 139, 137, 151, 163, 174, 194, 213, 225, 240, 252, 254, 254, 252, 240, 225, 213, 194, 174, 163, 151, 137, 139, 143, 140, 157, 184, 160,
      94,  70,  97, 114, 111, 115, 117, 103,  91,  80,  60,  41,  29,  14,   2,   0,   0,   2,  14,  29,  41,  60,  80,  91, 103, 117, 115, 111, 114,  97,  70,  94},
    {161, 208, 223, 226, 229, 232, 237, 239, 234, 233, 243, 251, 250, 250, 254, 252, 246, 242, 236, 225, 216, 211, 205, 197, 191, 183, 176, 169, 159, 143, 129, 126,
     128, 125, 111,  95,  85,  78,  71,  63,  57,  49,  43,  38,  29,  18,  12,   8,   2,   0,   4,   4,   3,  11,  21,  20,  15,  17,  22,  25,  28,  31,  46,  93},
    {153, 192, 207, 220, 241, 254, 244, 224, 214, 214, 208, 195, 186, 184, 181, 176, 171, 168, 162, 155, 155, 158, 153, 140, 137, 145, 148, 135, 123, 129, 140, 135,
     119, 114, 125, 131, 119, 106, 109, 117, 114, 101,  96,  99,  99,  92,  86,  83,  78,  73,  70,  68,  59,  46,  40,  40,  30,  10,   0,  13,  34,  47,  62, 101},
    {160, 200, 195, 185, 206, 243, 252, 225, 201, 212, 236, 226, 183, 152, 167, 202, 208, 180, 162, 178, 200, 188, 149, 129, 150, 175, 161, 118,  96, 116, 144, 140,
     114, 110, 138, 158, 136,  93,  79, 104, 125, 105,  66,  54,  76,  92,  74,  46,  52,  87, 102,  71,  28,  18,  42,  53,  29,   2,  11,  48,  69,  59,  54,  94},
    {193, 236, 153,  84, 109, 178, 224, 218, 181, 171, 200, 211, 181, 152, 143, 133, 116, 103, 101, 118, 142, 150, 143, 134, 115,  95, 112, 167, 222, 252, 243, 176,
      78,  11,   2,  32,  87, 142, 159, 139, 120, 111, 104, 112, 136, 153, 151, 138, 121, 111, 102,  73,  43,  54,  83,  73,  36,  30,  76, 145, 170, 101,  18,  61},
    {190, 254, 220, 176, 174, 178, 168, 172, 184, 163, 129, 137, 167, 151, 105, 106, 149, 153, 113, 106, 146, 164, 141, 129, 147, 154, 142, 141, 130,  74,  25,  72,
     182, 229, 180, 124, 113, 112, 100, 107, 125, 113,  90, 108, 148, 141, 101, 105, 148, 149, 103,  87, 117, 125,  91,  70,  82,  86,  76,  80,  78,  34,   0,  64},
    {185, 251, 239, 207, 192, 183, 172, 166, 166, 167, 163, 153, 148, 153, 157, 152, 144, 142, 145, 148, 145, 140, 138, 137, 137, 139, 137, 130, 128, 132, 132, 128,
     126, 122, 122, 126, 124, 117, 115, 117, 117, 116, 114, 109, 106, 109, 112, 110, 102,  97, 101, 106, 101,  91,  87,  88,  88,  82,  71,  62,  47,  15,   3,  69},
    {147, 171, 178, 184, 187, 186, 193, 200, 201, 204, 208, 209, 216, 221, 217, 224, 247, 252, 231, 211, 196, 171, 148, 131, 114, 106, 109, 114, 117, 128, 140, 135,
     119, 114, 126, 137, 140, 145, 148, 140, 123, 106,  83,  58,  43,  23,   2,   7,  30,  37,  33,  38,  45,  46,  50,  53,  54,  61,  68,  67,  70,  76,  83, 107},
    {168, 204, 187, 184, 197, 212, 222, 208, 202, 241, 244, 177, 162, 225, 232, 169, 151, 188, 198, 163, 134, 147, 168, 156, 142, 154, 147, 134, 162, 163, 103,  96,
     158, 151,  91,  92, 120, 107, 100, 112,  98,  86, 107, 120,  91,  56,  66, 103,  85,  22,  29,  92,  77,  10,  13,  52,  46,  32,  42,  57,  70,  67,  50,  86},
    {196, 254, 212, 194, 228, 246, 239, 238, 244, 249, 245, 230, 218, 215, 218, 219, 206, 183, 179, 187, 172, 154, 162, 166, 149, 152, 168, 160, 138, 134, 137, 131,
     123, 117, 120, 116,  94,  86, 102, 105,  88,  92, 100,  82,  67,  75,  71,  48,  35,  36,  39,  36,  24,   9,   5,  10,  16,  15,   8,  26,  60,  42,   0,  58},
    {184, 225, 190, 198, 245, 248, 218, 192, 169, 154, 155, 156, 155, 165, 162, 139, 130, 146, 157, 146, 126, 115, 124, 157, 203, 231, 209, 148,  90,  53,  49,  92,
     162, 205, 201, 164, 106,  45,  23,  51,  97, 130, 139, 128, 108,  97, 108, 124, 115,  92,  89,  99,  98,  99, 100,  85,  62,  36,   6,   9,  56,  64,  29,  70},
    {161, 209, 228, 242, 253, 253, 251, 251, 245, 234, 224, 212, 194, 175, 160, 152, 148, 143, 138, 138, 144, 152, 157, 155, 152, 151, 147, 142, 142, 140, 131, 126,
     128, 123, 114, 112, 112, 107, 103, 102,  99,  97, 102, 110, 116, 116, 111, 106, 102,  94,  79,  60,  42,  30,  20,   9,   3,   3,   1,   1,  12,  26,  45,  93},
    {189, 253, 224, 173, 155, 164, 190, 209, 206, 197, 197, 182, 156, 158, 184, 188, 165, 152, 150, 142, 133, 132, 131, 123, 114, 106, 106, 120, 130, 116,  97, 109,
     145, 157, 138, 124, 134, 148, 148, 140, 131, 123, 122, 121, 112, 104, 102,  89,  66,  70,  96,  98,  72,  57,  57,  48,  45,  64,  90,  99,  81,  30,   1,  65},
    {170, 177, 117, 149, 240, 230, 153, 137, 139, 100, 113, 210, 243, 173, 163, 238, 237, 161, 170, 239, 206, 108,  94, 134, 131, 148, 225, 236, 145, 114, 176, 170,
      84,  78, 140, 109,  18,  29, 106, 123, 120, 160, 146,  48,  15,  84,  93,  17,  16,  91,  81,  11,  44, 141, 154, 115, 117, 101,  24,  14, 105, 137,  77,  84},
    {131, 140, 149, 157, 165, 173, 181, 187, 194, 199, 204, 208, 212, 214, 216, 217, 217, 216, 214, 212, 208, 204, 199, 194, 187, 181, 173, 165, 157, 149, 140, 131,
     123, 114, 105,  97,  89,  81,  73,  67,  60,  55,  50,  46,  42,  40,  38,  37,  37,  38,  40,  42,  46,  50,  55,  60,  67,  73,  81,  89,  97, 105, 114, 123},
};

volatile uint8_t count = 0;

VCO_INTERRUPT()
{
    count = (count + 1 + (1 >> OPTS)) & BUFSIZE;
    uint8_t sample = table[INGATES][count];
    (sample > CV) ? OUTGATE_ON : OUTGATE_OFF;
    dac(sample);
}

int main() { setup(); for (;;) {} }
